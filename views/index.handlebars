{{>header}}
<script src="/assets/js/store.legacy.min.js"></script>
<header>
    <h1 class="text-center">Valego - Finanzas</h1>
</header>

<section id="acciones">
    <div class="container d-grid gap-2 mb-3">
        <button class="btn btn-outline-success" type="button" data-bs-toggle="modal" data-bs-target="#nuevaModal">Nueva finanza</button>
    </div>
    
    <div class="modal fade" id="nuevaModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog">
        <div class="modal-content">
        <form>
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Nueva finanza</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="mb-3">
                    <label for="id-fecha" class="form-label">Fecha</label>
                    <input type="date" name="fecha" id="id-fecha" class="form-control" required>
                </div>
                <div class="mb-3">
                    <label for="id-monto" class="form-label">Monto</label>
                    <input type="number" name="monto" id="id-monto" class="form-control" required>
                </div>
                <div class="mb-3">
                    <label for="id-nombre" class="form-label">Usuario/a</label>
                    <input type="text" name="persona" id="id-nombre" class="form-control" required>
                </div>
                <div class="mb-3">
                    <label for="id-descripcion" class="form-label">Descripción</label>
                    <input type="text" name="descripcion" id="id-descripcion" class="form-control" required>
                </div>
                <div class="mb-3">
                    <label for="id-tipo" class="form-label">Tipo de gasto</label>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="tipo" id="id-nofijo" value="nofijo" checked>
                        <label class="form-check-label" for="id-nofijo">
                            No fijo
                        </label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="tipo" id="id-fijo" value="fijo">
                        <label class="form-check-label" for="id-fijo">
                            Fijo
                        </label>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                <button type="submit" class="btn btn-primary">Agregar</button>
            </div>
        </form>
        </div>
        </div>
    </div>
</section>

<section id="ultimas">
    <div class="container">
        <table class="table table-success table-striped table-hover">
            <thead>
                <tr>
                    <th scope="col">Monto</th>
                    <th scope="col">Persona</th>
                    <th scope="col">Descripción</th>
                    <th scope="col">Detalles</th>
                </tr>
            </thead>
            <tbody>
                {{#each lista}}
                <tr data-id="{{this.id}}">
                    <td>{{this.monto}}</td>
                    <td>{{this.persona}}</td>
                    <td>{{this.descripcion}}</td>
                    <td><button class="btn btn-info">Detalles</button></td>
                </tr>
                {{/each}}
            </tbody>
        </table>
    </div>
</section>

<script>
$(() => {
    /*$.ajax({
        method: 'get',
        url: '/cosas',
        dataType: 'json',
        success: (data) => {
            $("#cosas").append(data.results[0].collection);
            console.log(data.results[0].collection);
        },
        error: (error) => {
            alert("Hubo un error... ¿wtf?")
        }
    });
    */
    
    $('form').submit(function(event){
        event.preventDefault();
        
        let datos = {};
        $(this).serializeArray().forEach((dato) => {
            datos[dato.name] = dato.value;
        });
        
        $.ajax({
            method: 'post',
            url: '/finanzas',
            contentType: 'application/json',
            data: JSON.stringify(datos),
            dataType: 'json',
            success: (response) => {
                alert("Nuevo movimiento agregado correctamente");
                console.log(response);
            },
            error: (error) => {
                alert("Ha ocurrido un error")
            }
        });
    })
})
</script>
{{>footer}}